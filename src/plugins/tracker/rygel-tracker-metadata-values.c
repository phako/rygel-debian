/* rygel-tracker-metadata-values.c generated by valac, the Vala compiler
 * generated from rygel-tracker-metadata-values.vala, do not modify */

/*
 * Copyright (C) 2008 Zeeshan Ali <zeenix@gmail.com>.
 * Copyright (C) 2008 Nokia Corporation.
 *
 * Author: Zeeshan Ali <zeenix@gmail.com>
 *
 * This file is part of Rygel.
 *
 * Rygel is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * Rygel is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 */

#include <glib.h>
#include <glib-object.h>
#include <rygel.h>
#include <dbus/dbus-glib-lowlevel.h>
#include <dbus/dbus-glib.h>
#include <gio/gio.h>
#include <stdlib.h>
#include <string.h>


#define RYGEL_TYPE_TRACKER_METADATA_VALUES (rygel_tracker_metadata_values_get_type ())
#define RYGEL_TRACKER_METADATA_VALUES(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_METADATA_VALUES, RygelTrackerMetadataValues))
#define RYGEL_TRACKER_METADATA_VALUES_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), RYGEL_TYPE_TRACKER_METADATA_VALUES, RygelTrackerMetadataValuesClass))
#define RYGEL_IS_TRACKER_METADATA_VALUES(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_METADATA_VALUES))
#define RYGEL_IS_TRACKER_METADATA_VALUES_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), RYGEL_TYPE_TRACKER_METADATA_VALUES))
#define RYGEL_TRACKER_METADATA_VALUES_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), RYGEL_TYPE_TRACKER_METADATA_VALUES, RygelTrackerMetadataValuesClass))

typedef struct _RygelTrackerMetadataValues RygelTrackerMetadataValues;
typedef struct _RygelTrackerMetadataValuesClass RygelTrackerMetadataValuesClass;
typedef struct _RygelTrackerMetadataValuesPrivate RygelTrackerMetadataValuesPrivate;

#define RYGEL_TYPE_TRACKER_METADATA_IFACE (rygel_tracker_metadata_iface_get_type ())
#define RYGEL_TRACKER_METADATA_IFACE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_METADATA_IFACE, RygelTrackerMetadataIface))
#define RYGEL_IS_TRACKER_METADATA_IFACE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_METADATA_IFACE))
#define RYGEL_TRACKER_METADATA_IFACE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), RYGEL_TYPE_TRACKER_METADATA_IFACE, RygelTrackerMetadataIfaceIface))

typedef struct _RygelTrackerMetadataIface RygelTrackerMetadataIface;
typedef struct _RygelTrackerMetadataIfaceIface RygelTrackerMetadataIfaceIface;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))
typedef struct _RygelTrackerMetadataValuesFetchMetadataValuesData RygelTrackerMetadataValuesFetchMetadataValuesData;

#define RYGEL_TYPE_TRACKER_SEARCH_CONTAINER (rygel_tracker_search_container_get_type ())
#define RYGEL_TRACKER_SEARCH_CONTAINER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_SEARCH_CONTAINER, RygelTrackerSearchContainer))
#define RYGEL_TRACKER_SEARCH_CONTAINER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), RYGEL_TYPE_TRACKER_SEARCH_CONTAINER, RygelTrackerSearchContainerClass))
#define RYGEL_IS_TRACKER_SEARCH_CONTAINER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_SEARCH_CONTAINER))
#define RYGEL_IS_TRACKER_SEARCH_CONTAINER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), RYGEL_TYPE_TRACKER_SEARCH_CONTAINER))
#define RYGEL_TRACKER_SEARCH_CONTAINER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), RYGEL_TYPE_TRACKER_SEARCH_CONTAINER, RygelTrackerSearchContainerClass))

typedef struct _RygelTrackerSearchContainer RygelTrackerSearchContainer;
typedef struct _RygelTrackerSearchContainerClass RygelTrackerSearchContainerClass;
#define _dbus_g_connection_unref0(var) ((var == NULL) ? NULL : (var = (dbus_g_connection_unref (var), NULL)))

struct _RygelTrackerMetadataIfaceIface {
	GTypeInterface parent_iface;
	void (*get_unique_values) (RygelTrackerMetadataIface* self, const char* service, char** meta_types, int meta_types_length1, const char* query, gboolean descending, gint offset, gint max_hits, GAsyncReadyCallback _callback_, gpointer _user_data_);
	char** (*get_unique_values_finish) (RygelTrackerMetadataIface* self, GAsyncResult* _res_, int* result_length1, int* result_length2, GError** error);
	void (*get) (RygelTrackerMetadataIface* self, const char* service_type, const char* uri, char** keys, int keys_length1, GAsyncReadyCallback _callback_, gpointer _user_data_);
	char** (*get_finish) (RygelTrackerMetadataIface* self, GAsyncResult* _res_, int* result_length1, GError** error);
};

struct _RygelTrackerMetadataValues {
	RygelSimpleContainer parent_instance;
	RygelTrackerMetadataValuesPrivate * priv;
	RygelTrackerMetadataIface* metadata;
	char* key;
};

struct _RygelTrackerMetadataValuesClass {
	RygelSimpleContainerClass parent_class;
};

struct _RygelTrackerMetadataValuesFetchMetadataValuesData {
	int _state_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	RygelTrackerMetadataValues* self;
	char** values;
	gint values_length2;
	gint values_length1;
	char** keys;
	char** _tmp0_;
	char** _tmp1_;
	gint keys_size;
	gint keys_length1;
	char** _tmp4_;
	gint _tmp3_;
	gint _tmp2_;
	char** _tmp5_;
	gint _tmp4__length2;
	gint _tmp4__length1;
	char** _tmp6_;
	GError * _error_;
	guint i;
	gboolean _tmp7_;
	char* value;
	char* query_condition;
	char* _tmp8_;
	char* _tmp9_;
	RygelTrackerSearchContainer* container;
	gint _tmp10__length1;
	char** _tmp10_;
	RygelTrackerSearchContainer* _tmp11_;
	GError * _inner_error_;
};


static gpointer rygel_tracker_metadata_values_parent_class = NULL;

GType rygel_tracker_metadata_values_get_type (void);
GType rygel_tracker_metadata_iface_get_type (void);
enum  {
	RYGEL_TRACKER_METADATA_VALUES_DUMMY_PROPERTY
};
#define RYGEL_TRACKER_METADATA_VALUES_TRACKER_SERVICE "org.freedesktop.Tracker"
#define RYGEL_TRACKER_METADATA_VALUES_METADATA_PATH "/org/freedesktop/Tracker/Metadata"
#define RYGEL_TRACKER_METADATA_VALUES_SERVICE "Files"
#define RYGEL_TRACKER_METADATA_VALUES_QUERY_CONDITION "<rdfq:Condition>\n" "<rdfq:equals>\n" "<rdfq:Property name=\"%s\" />\n" "<rdf:String>%s</rdf:String>\n" "</rdfq:equals>\n" "</rdfq:Condition>"
static void rygel_tracker_metadata_values_create_proxies (RygelTrackerMetadataValues* self, GError** error);
static void rygel_tracker_metadata_values_fetch_metadata_values (RygelTrackerMetadataValues* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void rygel_tracker_metadata_values_fetch_metadata_values_finish (RygelTrackerMetadataValues* self, GAsyncResult* _res_);
RygelTrackerMetadataValues* rygel_tracker_metadata_values_new (const char* key, const char* id, RygelMediaContainer* parent, const char* title);
RygelTrackerMetadataValues* rygel_tracker_metadata_values_construct (GType object_type, const char* key, const char* id, RygelMediaContainer* parent, const char* title);
static void rygel_tracker_metadata_values_fetch_metadata_values_data_free (gpointer _data);
static void rygel_tracker_metadata_values_fetch_metadata_values_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
void rygel_tracker_metadata_iface_get_unique_values (RygelTrackerMetadataIface* self, const char* service, char** meta_types, int meta_types_length1, const char* query, gboolean descending, gint offset, gint max_hits, GAsyncReadyCallback _callback_, gpointer _user_data_);
char** rygel_tracker_metadata_iface_get_unique_values_finish (RygelTrackerMetadataIface* self, GAsyncResult* _res_, int* result_length1, int* result_length2, GError** error);
RygelTrackerSearchContainer* rygel_tracker_search_container_new (const char* id, RygelMediaContainer* parent, const char* title, const char* service, const char* query_condition, char** keywords, int keywords_length1);
RygelTrackerSearchContainer* rygel_tracker_search_container_construct (GType object_type, const char* id, RygelMediaContainer* parent, const char* title, const char* service, const char* query_condition, char** keywords, int keywords_length1);
GType rygel_tracker_search_container_get_type (void);
static gboolean rygel_tracker_metadata_values_fetch_metadata_values_co (RygelTrackerMetadataValuesFetchMetadataValuesData* data);
static void rygel_tracker_metadata_values_finalize (GObject* obj);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);
static int _vala_strcmp0 (const char * str1, const char * str2);



RygelTrackerMetadataValues* rygel_tracker_metadata_values_construct (GType object_type, const char* key, const char* id, RygelMediaContainer* parent, const char* title) {
	GError * _inner_error_;
	RygelTrackerMetadataValues * self;
	char* _tmp0_;
	g_return_val_if_fail (key != NULL, NULL);
	g_return_val_if_fail (id != NULL, NULL);
	g_return_val_if_fail (parent != NULL, NULL);
	g_return_val_if_fail (title != NULL, NULL);
	_inner_error_ = NULL;
	self = (RygelTrackerMetadataValues*) rygel_simple_container_construct (object_type, id, parent, title);
	self->key = (_tmp0_ = g_strdup (key), _g_free0 (self->key), _tmp0_);
	{
		rygel_tracker_metadata_values_create_proxies (self, &_inner_error_);
		if (_inner_error_ != NULL) {
			if (_inner_error_->domain == DBUS_GERROR) {
				goto __catch0_dbus_gerror;
			}
			goto __finally0;
		}
	}
	goto __finally0;
	__catch0_dbus_gerror:
	{
		GError * _error_;
		_error_ = _inner_error_;
		_inner_error_ = NULL;
		{
			g_critical ("rygel-tracker-metadata-values.vala:60: Failed to create to Session bus: %s\n", _error_->message);
			_g_error_free0 (_error_);
			return self;
		}
	}
	__finally0:
	if (_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s", __FILE__, __LINE__, _inner_error_->message);
		g_clear_error (&_inner_error_);
		return NULL;
	}
	rygel_tracker_metadata_values_fetch_metadata_values (self, NULL, NULL);
	return self;
}


RygelTrackerMetadataValues* rygel_tracker_metadata_values_new (const char* key, const char* id, RygelMediaContainer* parent, const char* title) {
	return rygel_tracker_metadata_values_construct (RYGEL_TYPE_TRACKER_METADATA_VALUES, key, id, parent, title);
}


static void rygel_tracker_metadata_values_fetch_metadata_values_data_free (gpointer _data) {
	RygelTrackerMetadataValuesFetchMetadataValuesData* data;
	data = _data;
	g_slice_free (RygelTrackerMetadataValuesFetchMetadataValuesData, data);
}


static void rygel_tracker_metadata_values_fetch_metadata_values (RygelTrackerMetadataValues* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	RygelTrackerMetadataValuesFetchMetadataValuesData* _data_;
	_data_ = g_slice_new0 (RygelTrackerMetadataValuesFetchMetadataValuesData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, rygel_tracker_metadata_values_fetch_metadata_values);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, rygel_tracker_metadata_values_fetch_metadata_values_data_free);
	_data_->self = self;
	rygel_tracker_metadata_values_fetch_metadata_values_co (_data_);
}


static void rygel_tracker_metadata_values_fetch_metadata_values_finish (RygelTrackerMetadataValues* self, GAsyncResult* _res_) {
	RygelTrackerMetadataValuesFetchMetadataValuesData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void rygel_tracker_metadata_values_fetch_metadata_values_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	RygelTrackerMetadataValuesFetchMetadataValuesData* data;
	data = _user_data_;
	data->_res_ = _res_;
	rygel_tracker_metadata_values_fetch_metadata_values_co (data);
}


static gboolean rygel_tracker_metadata_values_fetch_metadata_values_co (RygelTrackerMetadataValuesFetchMetadataValuesData* data) {
	switch (data->_state_) {
		default:
		g_assert_not_reached ();
		case 0:
		{
			{
				data->keys = (data->_tmp1_ = (data->_tmp0_ = g_new0 (char*, 1 + 1), data->_tmp0_[0] = g_strdup (data->self->key), data->_tmp0_), data->keys_length1 = 1, data->keys_size = data->keys_length1, data->_tmp1_);
				rygel_tracker_metadata_iface_get_unique_values (data->self->metadata, RYGEL_TRACKER_METADATA_VALUES_SERVICE, data->keys, data->keys_length1, "", FALSE, 0, -1, rygel_tracker_metadata_values_fetch_metadata_values_ready, data);
				data->_state_ = 1;
				return FALSE;
				case 1:
				data->_tmp4_ = (data->_tmp5_ = rygel_tracker_metadata_iface_get_unique_values_finish (data->self->metadata, data->_res_, &data->_tmp2_, &data->_tmp3_, &data->_inner_error_), data->_tmp4__length1 = data->_tmp2_, data->_tmp4__length2 = data->_tmp3_, data->_tmp5_);
				if (data->_inner_error_ != NULL) {
					data->keys = (_vala_array_free (data->keys, data->keys_length1, (GDestroyNotify) g_free), NULL);
					if (data->_inner_error_->domain == DBUS_GERROR) {
						goto __catch1_dbus_gerror;
					}
					goto __finally1;
				}
				data->values = (data->_tmp6_ = data->_tmp4_, data->values = (_vala_array_free (data->values, data->values_length1 * data->values_length2, (GDestroyNotify) g_free), NULL), data->values_length1 = data->_tmp4__length1, data->values_length2 = data->_tmp4__length2, data->_tmp6_);
				data->keys = (_vala_array_free (data->keys, data->keys_length1, (GDestroyNotify) g_free), NULL);
			}
			goto __finally1;
			__catch1_dbus_gerror:
			{
				data->_error_ = data->_inner_error_;
				data->_inner_error_ = NULL;
				{
					g_critical ("rygel-tracker-metadata-values.vala:85: error getting all values for '%s': %s", data->self->key, data->_error_->message);
					_g_error_free0 (data->_error_);
					data->values = (_vala_array_free (data->values, data->values_length1 * data->values_length2, (GDestroyNotify) g_free), NULL);
					{
						if (data->_state_ == 0) {
							g_simple_async_result_complete_in_idle (data->_async_result);
						} else {
							g_simple_async_result_complete (data->_async_result);
						}
						g_object_unref (data->_async_result);
						return FALSE;
					}
					_g_error_free0 (data->_error_);
				}
			}
			__finally1:
			if (data->_inner_error_ != NULL) {
				data->values = (_vala_array_free (data->values, data->values_length1 * data->values_length2, (GDestroyNotify) g_free), NULL);
				g_critical ("file %s: line %d: uncaught error: %s", __FILE__, __LINE__, data->_inner_error_->message);
				g_clear_error (&data->_inner_error_);
				return FALSE;
			}
			{
				data->i = (guint) 0;
				{
					data->_tmp7_ = TRUE;
					while (TRUE) {
						if (!data->_tmp7_) {
							data->i++;
						}
						data->_tmp7_ = FALSE;
						if (!(data->i < data->values_length1)) {
							break;
						}
						data->value = g_strdup (data->values[(data->i * data->values_length2) + 0]);
						if (_vala_strcmp0 (data->value, "") == 0) {
							_g_free0 (data->value);
							continue;
						}
						data->query_condition = (data->_tmp9_ = g_strdup_printf (RYGEL_TRACKER_METADATA_VALUES_QUERY_CONDITION, data->self->key, data->_tmp8_ = g_markup_escape_text (data->value, -1)), _g_free0 (data->_tmp8_), data->_tmp9_);
						data->container = (data->_tmp11_ = rygel_tracker_search_container_new (data->value, (RygelMediaContainer*) data->self, data->value, RYGEL_TRACKER_METADATA_VALUES_SERVICE, data->query_condition, (data->_tmp10_ = g_new0 (char*, 0 + 1), data->_tmp10__length1 = 0, data->_tmp10_), 0), data->_tmp10_ = (_vala_array_free (data->_tmp10_, data->_tmp10__length1, (GDestroyNotify) g_free), NULL), data->_tmp11_);
						rygel_simple_container_add_child ((RygelSimpleContainer*) data->self, (RygelMediaObject*) data->container);
						_g_free0 (data->value);
						_g_free0 (data->query_condition);
						_g_object_unref0 (data->container);
					}
				}
			}
			rygel_media_container_updated ((RygelMediaContainer*) data->self);
			data->values = (_vala_array_free (data->values, data->values_length1 * data->values_length2, (GDestroyNotify) g_free), NULL);
		}
		{
			if (data->_state_ == 0) {
				g_simple_async_result_complete_in_idle (data->_async_result);
			} else {
				g_simple_async_result_complete (data->_async_result);
			}
			g_object_unref (data->_async_result);
			return FALSE;
		}
	}
}


static void rygel_tracker_metadata_values_create_proxies (RygelTrackerMetadataValues* self, GError** error) {
	GError * _inner_error_;
	DBusGConnection* connection;
	RygelTrackerMetadataIface* _tmp0_;
	g_return_if_fail (self != NULL);
	_inner_error_ = NULL;
	connection = dbus_g_bus_get (DBUS_BUS_SESSION, &_inner_error_);
	if (_inner_error_ != NULL) {
		if (_inner_error_->domain == DBUS_GERROR) {
			g_propagate_error (error, _inner_error_);
			return;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s", __FILE__, __LINE__, _inner_error_->message);
			g_clear_error (&_inner_error_);
			return;
		}
	}
	self->metadata = (_tmp0_ = rygel_tracker_metadata_iface_dbus_proxy_new (connection, RYGEL_TRACKER_METADATA_VALUES_TRACKER_SERVICE, RYGEL_TRACKER_METADATA_VALUES_METADATA_PATH), _g_object_unref0 (self->metadata), _tmp0_);
	_dbus_g_connection_unref0 (connection);
}


static void rygel_tracker_metadata_values_class_init (RygelTrackerMetadataValuesClass * klass) {
	rygel_tracker_metadata_values_parent_class = g_type_class_peek_parent (klass);
	G_OBJECT_CLASS (klass)->finalize = rygel_tracker_metadata_values_finalize;
}


static void rygel_tracker_metadata_values_instance_init (RygelTrackerMetadataValues * self) {
}


static void rygel_tracker_metadata_values_finalize (GObject* obj) {
	RygelTrackerMetadataValues * self;
	self = RYGEL_TRACKER_METADATA_VALUES (obj);
	_g_object_unref0 (self->metadata);
	_g_free0 (self->key);
	G_OBJECT_CLASS (rygel_tracker_metadata_values_parent_class)->finalize (obj);
}


GType rygel_tracker_metadata_values_get_type (void) {
	static GType rygel_tracker_metadata_values_type_id = 0;
	if (rygel_tracker_metadata_values_type_id == 0) {
		static const GTypeInfo g_define_type_info = { sizeof (RygelTrackerMetadataValuesClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) rygel_tracker_metadata_values_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (RygelTrackerMetadataValues), 0, (GInstanceInitFunc) rygel_tracker_metadata_values_instance_init, NULL };
		rygel_tracker_metadata_values_type_id = g_type_register_static (RYGEL_TYPE_SIMPLE_CONTAINER, "RygelTrackerMetadataValues", &g_define_type_info, 0);
	}
	return rygel_tracker_metadata_values_type_id;
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}


static int _vala_strcmp0 (const char * str1, const char * str2) {
	if (str1 == NULL) {
		return -(str1 != str2);
	}
	if (str2 == NULL) {
		return str1 != str2;
	}
	return strcmp (str1, str2);
}




