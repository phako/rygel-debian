/* rygel-tracker-selection-query.c generated by valac, the Vala compiler
 * generated from rygel-tracker-selection-query.vala, do not modify */

/*
 * Copyright (C) 20010 Nokia Corporation.
 *
 * Author: Zeeshan Ali <zeenix@gmail.com>
 *
 * This file is part of Rygel.
 *
 * Rygel is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * Rygel is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 */

#include <glib.h>
#include <glib-object.h>
#include <gio/gio.h>
#include <dbus/dbus-glib-lowlevel.h>
#include <dbus/dbus-glib.h>
#include <stdlib.h>
#include <string.h>
#include <gee.h>
#include <glib/gi18n-lib.h>


#define RYGEL_TYPE_TRACKER_QUERY (rygel_tracker_query_get_type ())
#define RYGEL_TRACKER_QUERY(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_QUERY, RygelTrackerQuery))
#define RYGEL_TRACKER_QUERY_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), RYGEL_TYPE_TRACKER_QUERY, RygelTrackerQueryClass))
#define RYGEL_IS_TRACKER_QUERY(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_QUERY))
#define RYGEL_IS_TRACKER_QUERY_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), RYGEL_TYPE_TRACKER_QUERY))
#define RYGEL_TRACKER_QUERY_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), RYGEL_TYPE_TRACKER_QUERY, RygelTrackerQueryClass))

typedef struct _RygelTrackerQuery RygelTrackerQuery;
typedef struct _RygelTrackerQueryClass RygelTrackerQueryClass;
typedef struct _RygelTrackerQueryPrivate RygelTrackerQueryPrivate;

#define RYGEL_TYPE_TRACKER_RESOURCES_IFACE (rygel_tracker_resources_iface_get_type ())
#define RYGEL_TRACKER_RESOURCES_IFACE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_RESOURCES_IFACE, RygelTrackerResourcesIface))
#define RYGEL_IS_TRACKER_RESOURCES_IFACE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_RESOURCES_IFACE))
#define RYGEL_TRACKER_RESOURCES_IFACE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), RYGEL_TYPE_TRACKER_RESOURCES_IFACE, RygelTrackerResourcesIfaceIface))

typedef struct _RygelTrackerResourcesIface RygelTrackerResourcesIface;
typedef struct _RygelTrackerResourcesIfaceIface RygelTrackerResourcesIfaceIface;

#define RYGEL_TYPE_TRACKER_QUERY_TRIPLETS (rygel_tracker_query_triplets_get_type ())
#define RYGEL_TRACKER_QUERY_TRIPLETS(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_QUERY_TRIPLETS, RygelTrackerQueryTriplets))
#define RYGEL_TRACKER_QUERY_TRIPLETS_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), RYGEL_TYPE_TRACKER_QUERY_TRIPLETS, RygelTrackerQueryTripletsClass))
#define RYGEL_IS_TRACKER_QUERY_TRIPLETS(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_QUERY_TRIPLETS))
#define RYGEL_IS_TRACKER_QUERY_TRIPLETS_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), RYGEL_TYPE_TRACKER_QUERY_TRIPLETS))
#define RYGEL_TRACKER_QUERY_TRIPLETS_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), RYGEL_TYPE_TRACKER_QUERY_TRIPLETS, RygelTrackerQueryTripletsClass))

typedef struct _RygelTrackerQueryTriplets RygelTrackerQueryTriplets;
typedef struct _RygelTrackerQueryTripletsClass RygelTrackerQueryTripletsClass;

#define RYGEL_TYPE_TRACKER_SELECTION_QUERY (rygel_tracker_selection_query_get_type ())
#define RYGEL_TRACKER_SELECTION_QUERY(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), RYGEL_TYPE_TRACKER_SELECTION_QUERY, RygelTrackerSelectionQuery))
#define RYGEL_TRACKER_SELECTION_QUERY_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), RYGEL_TYPE_TRACKER_SELECTION_QUERY, RygelTrackerSelectionQueryClass))
#define RYGEL_IS_TRACKER_SELECTION_QUERY(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), RYGEL_TYPE_TRACKER_SELECTION_QUERY))
#define RYGEL_IS_TRACKER_SELECTION_QUERY_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), RYGEL_TYPE_TRACKER_SELECTION_QUERY))
#define RYGEL_TRACKER_SELECTION_QUERY_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), RYGEL_TYPE_TRACKER_SELECTION_QUERY, RygelTrackerSelectionQueryClass))

typedef struct _RygelTrackerSelectionQuery RygelTrackerSelectionQuery;
typedef struct _RygelTrackerSelectionQueryClass RygelTrackerSelectionQueryClass;
typedef struct _RygelTrackerSelectionQueryPrivate RygelTrackerSelectionQueryPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
typedef struct _RygelTrackerSelectionQueryExecuteData RygelTrackerSelectionQueryExecuteData;

struct _RygelTrackerResourcesIfaceIface {
	GTypeInterface parent_iface;
	void (*sparql_query) (RygelTrackerResourcesIface* self, const char* query, GAsyncReadyCallback _callback_, gpointer _user_data_);
	char** (*sparql_query_finish) (RygelTrackerResourcesIface* self, GAsyncResult* _res_, int* result_length1, int* result_length2, GError** error);
	void (*sparql_update_blank) (RygelTrackerResourcesIface* self, const char* query, GAsyncReadyCallback _callback_, gpointer _user_data_);
	GHashTable** (*sparql_update_blank_finish) (RygelTrackerResourcesIface* self, GAsyncResult* _res_, int* result_length1, int* result_length2, GError** error);
};

struct _RygelTrackerQuery {
	GTypeInstance parent_instance;
	volatile int ref_count;
	RygelTrackerQueryPrivate * priv;
	RygelTrackerQueryTriplets* mandatory;
	RygelTrackerQueryTriplets* optional;
};

struct _RygelTrackerQueryClass {
	GTypeClass parent_class;
	void (*finalize) (RygelTrackerQuery *self);
	void (*execute) (RygelTrackerQuery* self, RygelTrackerResourcesIface* resources, GAsyncReadyCallback _callback_, gpointer _user_data_);
	void (*execute_finish) (RygelTrackerQuery* self, GAsyncResult* _res_, GError** error);
	char* (*to_string) (RygelTrackerQuery* self);
};

struct _RygelTrackerSelectionQuery {
	RygelTrackerQuery parent_instance;
	RygelTrackerSelectionQueryPrivate * priv;
	GeeArrayList* variables;
	GeeArrayList* filters;
	char* order_by;
	gint offset;
	gint max_count;
	char** result;
	gint result_length1;
	gint result_length2;
};

struct _RygelTrackerSelectionQueryClass {
	RygelTrackerQueryClass parent_class;
};

struct _RygelTrackerSelectionQueryExecuteData {
	int _state_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	RygelTrackerSelectionQuery* self;
	RygelTrackerResourcesIface* resources;
	char* str;
	char** _tmp2_;
	gint _tmp1_;
	gint _tmp0_;
	char** _tmp3_;
	gint _tmp2__length2;
	gint _tmp2__length1;
	char** _tmp4_;
	GError * _inner_error_;
};


static gpointer rygel_tracker_selection_query_parent_class = NULL;

gpointer rygel_tracker_query_ref (gpointer instance);
void rygel_tracker_query_unref (gpointer instance);
GParamSpec* rygel_param_spec_tracker_query (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags);
void rygel_value_set_tracker_query (GValue* value, gpointer v_object);
void rygel_value_take_tracker_query (GValue* value, gpointer v_object);
gpointer rygel_value_get_tracker_query (const GValue* value);
GType rygel_tracker_query_get_type (void);
RygelTrackerResourcesIface* rygel_tracker_resources_iface_dbus_proxy_new (DBusGConnection* connection, const char* name, const char* path);
GType rygel_tracker_resources_iface_get_type (void);
GType rygel_tracker_query_triplets_get_type (void);
GType rygel_tracker_selection_query_get_type (void);
enum  {
	RYGEL_TRACKER_SELECTION_QUERY_DUMMY_PROPERTY
};
RygelTrackerQuery* rygel_tracker_query_construct (GType object_type, RygelTrackerQueryTriplets* mandatory, RygelTrackerQueryTriplets* optional);
RygelTrackerSelectionQuery* rygel_tracker_selection_query_new (GeeArrayList* variables, RygelTrackerQueryTriplets* mandatory, RygelTrackerQueryTriplets* optional, GeeArrayList* filters, const char* order_by, gint offset, gint max_count);
RygelTrackerSelectionQuery* rygel_tracker_selection_query_construct (GType object_type, GeeArrayList* variables, RygelTrackerQueryTriplets* mandatory, RygelTrackerQueryTriplets* optional, GeeArrayList* filters, const char* order_by, gint offset, gint max_count);
static GeeArrayList* rygel_tracker_selection_query_copy_str_list (GeeList* str_list);
RygelTrackerQueryTriplets* rygel_tracker_query_triplets_new_clone (RygelTrackerQueryTriplets* triplets);
RygelTrackerQueryTriplets* rygel_tracker_query_triplets_construct_clone (GType object_type, RygelTrackerQueryTriplets* triplets);
RygelTrackerSelectionQuery* rygel_tracker_selection_query_new_clone (RygelTrackerSelectionQuery* query);
RygelTrackerSelectionQuery* rygel_tracker_selection_query_construct_clone (GType object_type, RygelTrackerSelectionQuery* query);
static void rygel_tracker_selection_query_real_execute_data_free (gpointer _data);
static void rygel_tracker_selection_query_real_execute (RygelTrackerQuery* base, RygelTrackerResourcesIface* resources, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void rygel_tracker_selection_query_execute_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
char* rygel_tracker_query_to_string (RygelTrackerQuery* self);
void rygel_tracker_resources_iface_sparql_query (RygelTrackerResourcesIface* self, const char* query, GAsyncReadyCallback _callback_, gpointer _user_data_);
char** rygel_tracker_resources_iface_sparql_query_finish (RygelTrackerResourcesIface* self, GAsyncResult* _res_, int* result_length1, int* result_length2, GError** error);
static gboolean rygel_tracker_selection_query_real_execute_co (RygelTrackerSelectionQueryExecuteData* data);
static char* rygel_tracker_selection_query_real_to_string (RygelTrackerQuery* base);
static void rygel_tracker_selection_query_finalize (RygelTrackerQuery* obj);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);



static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


#line 38 "rygel-tracker-selection-query.vala"
RygelTrackerSelectionQuery* rygel_tracker_selection_query_construct (GType object_type, GeeArrayList* variables, RygelTrackerQueryTriplets* mandatory, RygelTrackerQueryTriplets* optional, GeeArrayList* filters, const char* order_by, gint offset, gint max_count) {
#line 185 "rygel-tracker-selection-query.c"
	RygelTrackerSelectionQuery* self;
	GeeArrayList* _tmp2_;
	char* _tmp3_;
#line 38 "rygel-tracker-selection-query.vala"
	g_return_val_if_fail (variables != NULL, NULL);
#line 38 "rygel-tracker-selection-query.vala"
	g_return_val_if_fail (mandatory != NULL, NULL);
#line 45 "rygel-tracker-selection-query.vala"
	self = (RygelTrackerSelectionQuery*) rygel_tracker_query_construct (object_type, mandatory, optional);
#line 47 "rygel-tracker-selection-query.vala"
	if (filters != NULL) {
#line 197 "rygel-tracker-selection-query.c"
		GeeArrayList* _tmp0_;
#line 48 "rygel-tracker-selection-query.vala"
		self->filters = (_tmp0_ = _g_object_ref0 (filters), _g_object_unref0 (self->filters), _tmp0_);
#line 201 "rygel-tracker-selection-query.c"
	} else {
		GeeArrayList* _tmp1_;
#line 50 "rygel-tracker-selection-query.vala"
		self->filters = (_tmp1_ = gee_array_list_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, NULL), _g_object_unref0 (self->filters), _tmp1_);
#line 206 "rygel-tracker-selection-query.c"
	}
#line 53 "rygel-tracker-selection-query.vala"
	self->variables = (_tmp2_ = _g_object_ref0 (variables), _g_object_unref0 (self->variables), _tmp2_);
#line 54 "rygel-tracker-selection-query.vala"
	self->order_by = (_tmp3_ = g_strdup (order_by), _g_free0 (self->order_by), _tmp3_);
#line 55 "rygel-tracker-selection-query.vala"
	self->offset = offset;
#line 56 "rygel-tracker-selection-query.vala"
	self->max_count = max_count;
#line 216 "rygel-tracker-selection-query.c"
	return self;
}


#line 38 "rygel-tracker-selection-query.vala"
RygelTrackerSelectionQuery* rygel_tracker_selection_query_new (GeeArrayList* variables, RygelTrackerQueryTriplets* mandatory, RygelTrackerQueryTriplets* optional, GeeArrayList* filters, const char* order_by, gint offset, gint max_count) {
#line 38 "rygel-tracker-selection-query.vala"
	return rygel_tracker_selection_query_construct (RYGEL_TYPE_TRACKER_SELECTION_QUERY, variables, mandatory, optional, filters, order_by, offset, max_count);
#line 225 "rygel-tracker-selection-query.c"
}


#line 59 "rygel-tracker-selection-query.vala"
RygelTrackerSelectionQuery* rygel_tracker_selection_query_construct_clone (GType object_type, RygelTrackerSelectionQuery* query) {
#line 231 "rygel-tracker-selection-query.c"
	RygelTrackerSelectionQuery* self;
	GeeArrayList* _tmp3_;
	RygelTrackerQueryTriplets* _tmp2_;
	RygelTrackerQueryTriplets* _tmp1_;
	GeeArrayList* _tmp0_;
#line 59 "rygel-tracker-selection-query.vala"
	g_return_val_if_fail (query != NULL, NULL);
#line 60 "rygel-tracker-selection-query.vala"
	self = (RygelTrackerSelectionQuery*) rygel_tracker_selection_query_construct (object_type, _tmp0_ = rygel_tracker_selection_query_copy_str_list ((GeeList*) query->variables), _tmp1_ = rygel_tracker_query_triplets_new_clone (((RygelTrackerQuery*) query)->mandatory), _tmp2_ = rygel_tracker_query_triplets_new_clone (((RygelTrackerQuery*) query)->optional), _tmp3_ = rygel_tracker_selection_query_copy_str_list ((GeeList*) query->filters), query->order_by, query->offset, query->max_count);
#line 241 "rygel-tracker-selection-query.c"
	_g_object_unref0 (_tmp3_);
	_g_object_unref0 (_tmp2_);
	_g_object_unref0 (_tmp1_);
	_g_object_unref0 (_tmp0_);
	return self;
}


#line 59 "rygel-tracker-selection-query.vala"
RygelTrackerSelectionQuery* rygel_tracker_selection_query_new_clone (RygelTrackerSelectionQuery* query) {
#line 59 "rygel-tracker-selection-query.vala"
	return rygel_tracker_selection_query_construct_clone (RYGEL_TYPE_TRACKER_SELECTION_QUERY, query);
#line 254 "rygel-tracker-selection-query.c"
}


static void rygel_tracker_selection_query_real_execute_data_free (gpointer _data) {
	RygelTrackerSelectionQueryExecuteData* data;
	data = _data;
	_g_object_unref0 (data->resources);
	rygel_tracker_query_unref (data->self);
	g_slice_free (RygelTrackerSelectionQueryExecuteData, data);
}


static void rygel_tracker_selection_query_real_execute (RygelTrackerQuery* base, RygelTrackerResourcesIface* resources, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	RygelTrackerSelectionQuery * self;
	RygelTrackerSelectionQueryExecuteData* _data_;
	self = (RygelTrackerSelectionQuery*) base;
	_data_ = g_slice_new0 (RygelTrackerSelectionQueryExecuteData);
	_data_->_async_result = g_simple_async_result_new (g_object_newv (G_TYPE_OBJECT, 0, NULL), _callback_, _user_data_, rygel_tracker_selection_query_real_execute);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, rygel_tracker_selection_query_real_execute_data_free);
	_data_->self = rygel_tracker_query_ref (self);
	_data_->resources = _g_object_ref0 (resources);
	rygel_tracker_selection_query_real_execute_co (_data_);
}


static void rygel_tracker_selection_query_real_execute_finish (RygelTrackerQuery* base, GAsyncResult* _res_, GError** error) {
	RygelTrackerSelectionQueryExecuteData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void rygel_tracker_selection_query_execute_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	RygelTrackerSelectionQueryExecuteData* data;
	data = _user_data_;
	data->_res_ = _res_;
	rygel_tracker_selection_query_real_execute_co (data);
}


static gboolean rygel_tracker_selection_query_real_execute_co (RygelTrackerSelectionQueryExecuteData* data) {
	switch (data->_state_) {
		case 0:
		goto _state_0;
		case 7:
		goto _state_7;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	{
		data->str = rygel_tracker_query_to_string ((RygelTrackerQuery*) data->self);
#line 73 "rygel-tracker-selection-query.vala"
		g_debug (_ ("Executing SPARQL query: %s"), data->str);
#line 311 "rygel-tracker-selection-query.c"
		data->_state_ = 7;
		rygel_tracker_resources_iface_sparql_query (data->resources, data->str, rygel_tracker_selection_query_execute_ready, data);
		return FALSE;
		_state_7:
		data->_tmp2_ = (data->_tmp3_ = rygel_tracker_resources_iface_sparql_query_finish (data->resources, data->_res_, &data->_tmp0_, &data->_tmp1_, &data->_inner_error_), data->_tmp2__length1 = data->_tmp0_, data->_tmp2__length2 = data->_tmp1_, data->_tmp3_);
		if (data->_inner_error_ != NULL) {
			if (data->_inner_error_->domain == DBUS_GERROR) {
				g_simple_async_result_set_from_error (data->_async_result, data->_inner_error_);
				g_error_free (data->_inner_error_);
				_g_free0 (data->str);
				{
					if (data->_state_ == 0) {
						g_simple_async_result_complete_in_idle (data->_async_result);
					} else {
						g_simple_async_result_complete (data->_async_result);
					}
					g_object_unref (data->_async_result);
					return FALSE;
				}
			} else {
				_g_free0 (data->str);
				g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, data->_inner_error_->message, g_quark_to_string (data->_inner_error_->domain), data->_inner_error_->code);
				g_clear_error (&data->_inner_error_);
				return FALSE;
			}
		}
#line 75 "rygel-tracker-selection-query.vala"
		data->self->result = (data->_tmp4_ = data->_tmp2_, data->self->result = (_vala_array_free (data->self->result, data->self->result_length1 * data->self->result_length2, (GDestroyNotify) g_free), NULL), data->self->result_length1 = data->_tmp2__length1, data->self->result_length2 = data->_tmp2__length2, data->_tmp4_);
#line 340 "rygel-tracker-selection-query.c"
		_g_free0 (data->str);
	}
	{
		if (data->_state_ == 0) {
			g_simple_async_result_complete_in_idle (data->_async_result);
		} else {
			g_simple_async_result_complete (data->_async_result);
		}
		g_object_unref (data->_async_result);
		return FALSE;
	}
}


#line 78 "rygel-tracker-selection-query.vala"
static char* rygel_tracker_selection_query_real_to_string (RygelTrackerQuery* base) {
#line 357 "rygel-tracker-selection-query.c"
	RygelTrackerSelectionQuery * self;
	char* result = NULL;
	char* query;
	char* _tmp4_;
	char* _tmp3_;
	char* _tmp2_;
	char* _tmp11_;
	char* _tmp16_;
	char* _tmp15_;
	char* _tmp14_;
	self = (RygelTrackerSelectionQuery*) base;
#line 79 "rygel-tracker-selection-query.vala"
	query = g_strdup ("SELECT ");
#line 371 "rygel-tracker-selection-query.c"
	{
		GeeIterator* _variable_it;
		_variable_it = gee_abstract_collection_iterator ((GeeAbstractCollection*) self->variables);
#line 81 "rygel-tracker-selection-query.vala"
		while (TRUE) {
#line 377 "rygel-tracker-selection-query.c"
			char* variable;
			char* _tmp1_;
			char* _tmp0_;
#line 81 "rygel-tracker-selection-query.vala"
			if (!gee_iterator_next (_variable_it)) {
#line 81 "rygel-tracker-selection-query.vala"
				break;
#line 385 "rygel-tracker-selection-query.c"
			}
#line 81 "rygel-tracker-selection-query.vala"
			variable = (char*) gee_iterator_get (_variable_it);
#line 82 "rygel-tracker-selection-query.vala"
			query = (_tmp1_ = g_strconcat (query, _tmp0_ = g_strconcat (" ", variable, NULL), NULL), _g_free0 (query), _tmp1_);
#line 391 "rygel-tracker-selection-query.c"
			_g_free0 (_tmp0_);
			_g_free0 (variable);
		}
		_g_object_unref0 (_variable_it);
	}
#line 85 "rygel-tracker-selection-query.vala"
	query = (_tmp4_ = g_strconcat (query, _tmp3_ = g_strconcat (" WHERE { ", _tmp2_ = RYGEL_TRACKER_QUERY_CLASS (rygel_tracker_selection_query_parent_class)->to_string (RYGEL_TRACKER_QUERY (self)), NULL), NULL), _g_free0 (query), _tmp4_);
#line 399 "rygel-tracker-selection-query.c"
	_g_free0 (_tmp3_);
	_g_free0 (_tmp2_);
#line 87 "rygel-tracker-selection-query.vala"
	if (gee_collection_get_size ((GeeCollection*) self->filters) > 0) {
#line 404 "rygel-tracker-selection-query.c"
		char* _tmp5_;
		char* _tmp10_;
#line 88 "rygel-tracker-selection-query.vala"
		query = (_tmp5_ = g_strconcat (query, " FILTER (", NULL), _g_free0 (query), _tmp5_);
#line 409 "rygel-tracker-selection-query.c"
		{
			gint i;
#line 89 "rygel-tracker-selection-query.vala"
			i = 0;
#line 414 "rygel-tracker-selection-query.c"
			{
				gboolean _tmp6_;
#line 89 "rygel-tracker-selection-query.vala"
				_tmp6_ = TRUE;
#line 89 "rygel-tracker-selection-query.vala"
				while (TRUE) {
#line 421 "rygel-tracker-selection-query.c"
					char* _tmp8_;
					char* _tmp7_;
#line 89 "rygel-tracker-selection-query.vala"
					if (!_tmp6_) {
#line 89 "rygel-tracker-selection-query.vala"
						i++;
#line 428 "rygel-tracker-selection-query.c"
					}
#line 89 "rygel-tracker-selection-query.vala"
					_tmp6_ = FALSE;
#line 89 "rygel-tracker-selection-query.vala"
					if (!(i < gee_collection_get_size ((GeeCollection*) self->filters))) {
#line 89 "rygel-tracker-selection-query.vala"
						break;
#line 436 "rygel-tracker-selection-query.c"
					}
#line 90 "rygel-tracker-selection-query.vala"
					query = (_tmp8_ = g_strconcat (query, _tmp7_ = (char*) gee_abstract_list_get ((GeeAbstractList*) self->filters, i), NULL), _g_free0 (query), _tmp8_);
#line 440 "rygel-tracker-selection-query.c"
					_g_free0 (_tmp7_);
#line 92 "rygel-tracker-selection-query.vala"
					if (i < (gee_collection_get_size ((GeeCollection*) self->filters) - 1)) {
#line 444 "rygel-tracker-selection-query.c"
						char* _tmp9_;
#line 93 "rygel-tracker-selection-query.vala"
						query = (_tmp9_ = g_strconcat (query, " && ", NULL), _g_free0 (query), _tmp9_);
#line 448 "rygel-tracker-selection-query.c"
					}
				}
			}
		}
#line 96 "rygel-tracker-selection-query.vala"
		query = (_tmp10_ = g_strconcat (query, ")", NULL), _g_free0 (query), _tmp10_);
#line 455 "rygel-tracker-selection-query.c"
	}
#line 99 "rygel-tracker-selection-query.vala"
	query = (_tmp11_ = g_strconcat (query, " }", NULL), _g_free0 (query), _tmp11_);
#line 101 "rygel-tracker-selection-query.vala"
	if (self->order_by != NULL) {
#line 461 "rygel-tracker-selection-query.c"
		char* _tmp13_;
		char* _tmp12_;
#line 102 "rygel-tracker-selection-query.vala"
		query = (_tmp13_ = g_strconcat (query, _tmp12_ = g_strconcat (" ORDER BY ", self->order_by, NULL), NULL), _g_free0 (query), _tmp13_);
#line 466 "rygel-tracker-selection-query.c"
		_g_free0 (_tmp12_);
	}
#line 105 "rygel-tracker-selection-query.vala"
	query = (_tmp16_ = g_strconcat (query, _tmp15_ = g_strconcat (" OFFSET ", _tmp14_ = g_strdup_printf ("%i", self->offset), NULL), NULL), _g_free0 (query), _tmp16_);
#line 471 "rygel-tracker-selection-query.c"
	_g_free0 (_tmp15_);
	_g_free0 (_tmp14_);
#line 107 "rygel-tracker-selection-query.vala"
	if (self->max_count != (-1)) {
#line 476 "rygel-tracker-selection-query.c"
		char* _tmp19_;
		char* _tmp18_;
		char* _tmp17_;
#line 108 "rygel-tracker-selection-query.vala"
		query = (_tmp19_ = g_strconcat (query, _tmp18_ = g_strconcat (" LIMIT ", _tmp17_ = g_strdup_printf ("%i", self->max_count), NULL), NULL), _g_free0 (query), _tmp19_);
#line 482 "rygel-tracker-selection-query.c"
		_g_free0 (_tmp18_);
		_g_free0 (_tmp17_);
	}
	result = query;
#line 111 "rygel-tracker-selection-query.vala"
	return result;
#line 489 "rygel-tracker-selection-query.c"
}


#line 114 "rygel-tracker-selection-query.vala"
static GeeArrayList* rygel_tracker_selection_query_copy_str_list (GeeList* str_list) {
#line 495 "rygel-tracker-selection-query.c"
	GeeArrayList* result = NULL;
	GeeArrayList* copy;
#line 114 "rygel-tracker-selection-query.vala"
	g_return_val_if_fail (str_list != NULL, NULL);
#line 115 "rygel-tracker-selection-query.vala"
	copy = gee_array_list_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, NULL);
#line 117 "rygel-tracker-selection-query.vala"
	gee_abstract_collection_add_all ((GeeAbstractCollection*) copy, (GeeCollection*) str_list);
#line 504 "rygel-tracker-selection-query.c"
	result = copy;
#line 119 "rygel-tracker-selection-query.vala"
	return result;
#line 508 "rygel-tracker-selection-query.c"
}


static void rygel_tracker_selection_query_class_init (RygelTrackerSelectionQueryClass * klass) {
	rygel_tracker_selection_query_parent_class = g_type_class_peek_parent (klass);
	RYGEL_TRACKER_QUERY_CLASS (klass)->finalize = rygel_tracker_selection_query_finalize;
	RYGEL_TRACKER_QUERY_CLASS (klass)->execute = rygel_tracker_selection_query_real_execute;
	RYGEL_TRACKER_QUERY_CLASS (klass)->execute_finish = rygel_tracker_selection_query_real_execute_finish;
	RYGEL_TRACKER_QUERY_CLASS (klass)->to_string = rygel_tracker_selection_query_real_to_string;
}


static void rygel_tracker_selection_query_instance_init (RygelTrackerSelectionQuery * self) {
}


static void rygel_tracker_selection_query_finalize (RygelTrackerQuery* obj) {
	RygelTrackerSelectionQuery * self;
	self = RYGEL_TRACKER_SELECTION_QUERY (obj);
	_g_object_unref0 (self->variables);
	_g_object_unref0 (self->filters);
	_g_free0 (self->order_by);
	self->result = (_vala_array_free (self->result, self->result_length1 * self->result_length2, (GDestroyNotify) g_free), NULL);
	RYGEL_TRACKER_QUERY_CLASS (rygel_tracker_selection_query_parent_class)->finalize (obj);
}


GType rygel_tracker_selection_query_get_type (void) {
	static volatile gsize rygel_tracker_selection_query_type_id__volatile = 0;
	if (g_once_init_enter (&rygel_tracker_selection_query_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (RygelTrackerSelectionQueryClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) rygel_tracker_selection_query_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (RygelTrackerSelectionQuery), 0, (GInstanceInitFunc) rygel_tracker_selection_query_instance_init, NULL };
		GType rygel_tracker_selection_query_type_id;
		rygel_tracker_selection_query_type_id = g_type_register_static (RYGEL_TYPE_TRACKER_QUERY, "RygelTrackerSelectionQuery", &g_define_type_info, 0);
		g_once_init_leave (&rygel_tracker_selection_query_type_id__volatile, rygel_tracker_selection_query_type_id);
	}
	return rygel_tracker_selection_query_type_id__volatile;
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}




